!function(){function e(e){if(void 0===p)p=e;else if(p!=e)throw"you cannot combine the navigator.id.watch() API with navigator.id.getVerifiedEmail() or navigator.id.get()this site should instead use navigator.id.request() and navigator.id.watch()"}function t(){if(f)try{if(!s){var e=window.document,t=e.createElement("iframe");t.style.display="none",e.body.appendChild(t),t.src=l+"/communication_iframe",s=r.build({window:t.contentWindow,origin:l,scope:"mozid_ni",onReady:function(){s.call({method:"loaded",success:function(){h.ready&&h.ready()},error:function(){}})}}),s.bind("logout",function(){h.logout&&h.logout()}),s.bind("login",function(e,t){h.login&&h.login(t)})}}catch(n){s=void 0}}function n(e){if("object"==typeof e){if(e.onlogin&&"function"!=typeof e.onlogin||e.onlogout&&"function"!=typeof e.onlogout||e.onready&&"function"!=typeof e.onready)throw"non-function where function expected in parameters to navigator.id.watch()";if(!e.onlogin)throw"'onlogin' is a required argument to navigator.id.watch()";if(!e.onlogout)throw"'onlogout' is a required argument to navigator.id.watch()";h.login=e.onlogin||null,h.logout=e.onlogout||null,h.ready=e.onready||null,t(),"undefined"!=typeof e.loggedInEmail&&s&&s.notify({method:"loggedInUser",params:e.loggedInEmail})}}function i(e){if(a)try{a.focus()}catch(t){}else{if(!o.isSupported()){var n=o.getNoSupportReason(),i="unsupported_dialog";return"LOCALSTORAGE_DISABLED"===n&&(i="cookies_disabled"),a=window.open(l+"/"+i,null,u),void 0}s&&s.notify({method:"dialog_running"}),e.returnTo||(e.returnTo=document.location.pathname),a=WinChan.open({url:l+"/sign_in",relay_url:l+"/relay",window_features:u,params:{method:"get",params:e}},function(t,n){if(s&&(!t&&n&&n.email&&s.notify({method:"loggedInUser",params:n.email}),s.notify({method:"dialog_complete"})),a=void 0,!t&&n&&n.assertion)try{h.login&&h.login(n.assertion)}catch(i){}"client closed window"!==t&&n||(e&&e.oncancel&&e.oncancel(),delete e.oncancel)})}}var r=function(){function e(e){return Array.isArray?Array.isArray(e):-1!=e.constructor.toString().indexOf("Array")}function t(e,t,n){for(var i=r[t][n],o=0;o<i.length;o++)i[o].win===e&&i.splice(o,1);0===r[t][n].length&&delete r[t][n]}function n(e,t,n,i){function o(t){for(var n=0;n<t.length;n++)if(t[n].win===e)return!0;return!1}var a=!1;if("*"===t){for(var s in r)if(r.hasOwnProperty(s)&&"*"!==s&&"object"==typeof r[s][n]&&(a=o(r[s][n])))break}else r["*"]&&r["*"][n]&&(a=o(r["*"][n])),!a&&r[t]&&r[t][n]&&(a=o(r[t][n]));if(a)throw"A channel is already bound to the same window which overlaps with origin '"+t+"' and has scope '"+n+"'";"object"!=typeof r[t]&&(r[t]={}),"object"!=typeof r[t][n]&&(r[t][n]=[]),r[t][n].push({win:e,handler:i})}var i=Math.floor(1000001*Math.random()),r={},o={},a=function(e){try{var t=JSON.parse(e.data);if("object"!=typeof t||null===t)throw"malformed"}catch(e){return}var n,i,a,s=e.source,l=e.origin;if("string"==typeof t.method){var c=t.method.split("::");2==c.length?(n=c[0],a=c[1]):a=t.method}if("undefined"!=typeof t.id&&(i=t.id),"string"==typeof a){var d=!1;if(r[l]&&r[l][n])for(var i=0;i<r[l][n].length;i++)if(r[l][n][i].win===s){r[l][n][i].handler(l,a,t),d=!0;break}if(!d&&r["*"]&&r["*"][n])for(var i=0;i<r["*"][n].length;i++)if(r["*"][n][i].win===s){r["*"][n][i].handler(l,a,t);break}}else"undefined"!=typeof i&&o[i]&&o[i](l,a,t)};return window.addEventListener?window.addEventListener("message",a,!1):window.attachEvent&&window.attachEvent("onmessage",a),{build:function(r){var a=function(e){if(r.debugOutput&&window.console&&window.console.log){try{"string"!=typeof e&&(e=JSON.stringify(e))}catch(t){}console.log("["+c+"] "+e)}};if(!window.postMessage)throw"jschannel cannot run this browser, no postMessage";if(!window.JSON||!window.JSON.stringify||!window.JSON.parse)throw"jschannel cannot run this browser, no JSON parsing/serialization";if("object"!=typeof r)throw"Channel build invoked without a proper object argument";if(!r.window||!r.window.postMessage)throw"Channel.build() called without a valid window argument";if(window===r.window)throw"target window is same as present window -- not allowed";var s=!1;if("string"==typeof r.origin){var l;"*"===r.origin?s=!0:null!==(l=r.origin.match(/^https?:\/\/(?:[-a-zA-Z0-9_\.])+(?::\d+)?/))&&(r.origin=l[0].toLowerCase(),s=!0)}if(!s)throw"Channel.build() called with an invalid origin";if("undefined"!=typeof r.scope){if("string"!=typeof r.scope)throw"scope, when specified, must be a string";if(r.scope.split("::").length>1)throw"scope may not contain double colons: '::'"}var c=function(){for(var e="",t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n=0;5>n;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}(),d={},u={},h={},p=!1,f=[],m=function(e,t,n){var i=!1,r=!1;return{origin:t,invoke:function(t,i){if(!h[e])throw"attempting to invoke a callback of a nonexistent transaction: "+e;for(var r=!1,o=0;o<n.length;o++)if(t===n[o]){r=!0;break}if(!r)throw"request supports no such callback '"+t+"'";b({id:e,callback:t,params:i})},error:function(t,n){if(r=!0,!h[e])throw"error called for nonexistent message: "+e;delete h[e],b({id:e,error:t,message:n})},complete:function(t){if(r=!0,!h[e])throw"complete called for nonexistent message: "+e;delete h[e],b({id:e,result:t})},delayReturn:function(e){return"boolean"==typeof e&&(i=e===!0),i},completed:function(){return r}}},g=function(e,t,n){return window.setTimeout(function(){if(u[e]){var i="timeout ("+t+"ms) exceeded on method '"+n+"'";u[e].error("timeout_error",i),delete u[e],delete o[e]}},t)},v=function(t,n,i){if("function"==typeof r.gotMessageObserver)try{r.gotMessageObserver(t,i)}catch(s){a("gotMessageObserver() raised an exception: "+s.toString())}if(i.id&&n){if(d[n]){var l=m(i.id,t,i.callbacks?i.callbacks:[]);h[i.id]={};try{if(i.callbacks&&e(i.callbacks)&&i.callbacks.length>0)for(var c=0;c<i.callbacks.length;c++){for(var p=i.callbacks[c],f=i.params,g=p.split("/"),v=0;v<g.length-1;v++){var y=g[v];"object"!=typeof f[y]&&(f[y]={}),f=f[y]}f[g[g.length-1]]=function(){var e=p;return function(t){return l.invoke(e,t)}}()}var b=d[n](l,i.params);!l.delayReturn()&&!l.completed()&&l.complete(b)}catch(s){var _="runtime_error",w=null;if("string"==typeof s?w=s:"object"==typeof s&&(s&&e(s)&&2==s.length?(_=s[0],w=s[1]):"string"==typeof s.error&&(_=s.error,s.message?"string"==typeof s.message?w=s.message:s=s.message:w="")),null===w)try{w=JSON.stringify(s),"undefined"==typeof w&&(w=s.toString())}catch(k){w=s.toString()}l.error(_,w)}}}else i.id&&i.callback?u[i.id]&&u[i.id].callbacks&&u[i.id].callbacks[i.callback]?u[i.id].callbacks[i.callback](i.params):a("ignoring invalid callback, id:"+i.id+" ("+i.callback+")"):i.id?u[i.id]?(i.error?u[i.id].error(i.error,i.message):void 0!==i.result?u[i.id].success(i.result):u[i.id].success(),delete u[i.id],delete o[i.id]):a("ignoring invalid response: "+i.id):n&&d[n]&&d[n](null,i.params)};n(r.window,r.origin,"string"==typeof r.scope?r.scope:"",v);var y=function(e){return"string"==typeof r.scope&&r.scope.length&&(e=[r.scope,e].join("::")),e},b=function(e,t){if(!e)throw"postMessage called with null message";var n=p?"post  ":"queue ";if(a(n+" message: "+JSON.stringify(e)),t||p){if("function"==typeof r.postMessageObserver)try{r.postMessageObserver(r.origin,e)}catch(i){a("postMessageObserver() raised an exception: "+i.toString())}r.window.postMessage(JSON.stringify(e),r.origin)}else f.push(e)},_=function(e,t){if(a("ready msg received"),p)throw"received ready message while in ready state.  help!";for(c+="ping"===t?"-R":"-L",w.unbind("__ready"),p=!0,a("ready msg accepted."),"ping"===t&&w.notify({method:"__ready",params:"pong"});f.length;)b(f.pop());"function"==typeof r.onReady&&r.onReady(w)},w={unbind:function(e){if(d[e]){if(delete d[e])return!0;throw"can't delete method: "+e}return!1},bind:function(e,t){if(!e||"string"!=typeof e)throw"'method' argument to bind must be string";if(!t||"function"!=typeof t)throw"callback missing from bind params";if(d[e])throw"method '"+e+"' is already bound!";return d[e]=t,this},call:function(e){if(!e)throw"missing arguments to call function";if(!e.method||"string"!=typeof e.method)throw"'method' argument to call must be string";if(!e.success||"function"!=typeof e.success)throw"'success' callback missing from call";var t={},n=[],r=function(e,i){if("object"==typeof i)for(var o in i)if(i.hasOwnProperty(o)){var a=e+(e.length?"/":"")+o;"function"==typeof i[o]?(t[a]=i[o],n.push(a),delete i[o]):"object"==typeof i[o]&&r(a,i[o])}};r("",e.params);var a={id:i,method:y(e.method),params:e.params};n.length&&(a.callbacks=n),e.timeout&&g(i,e.timeout,y(e.method)),u[i]={callbacks:t,error:e.error,success:e.success},o[i]=v,i++,b(a)},notify:function(e){if(!e)throw"missing arguments to notify function";if(!e.method||"string"!=typeof e.method)throw"'method' argument to notify must be string";b({method:y(e.method),params:e.params})},destroy:function(){t(r.window,r.origin,"string"==typeof r.scope?r.scope:""),window.removeEventListener?window.removeEventListener("message",v,!1):window.detachEvent&&window.detachEvent("onmessage",v),p=!1,d={},h={},u={},r.origin=null,f=[],a("channel destroyed"),c=""}};return w.bind("__ready",_),setTimeout(function(){},0),w}}}();WinChan=function(){function e(e){/^https?:\/\//.test(e)||(e=window.location.href);var t=/^(https?:\/\/[-_a-zA-Z\.0-9:]+)/.exec(e);return t?t[1]:e}function t(){return window.JSON&&window.JSON.stringify&&window.JSON.parse&&window.postMessage}function n(){try{return-1!=c.indexOf("Fennec/")||-1!=c.indexOf("Firefox/")&&-1!=c.indexOf("Android")}catch(e){}return!1}function i(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=n.exec(t)&&(e=parseFloat(RegExp.$1))}return e>=8}function r(e,t,n){e.detachEvent?e.detachEvent("on"+t,n):e.removeEventListener&&e.removeEventListener(t,n,!1)}function o(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener&&e.addEventListener(t,n,!1)}var a="__winchan_relay_frame",s=i();return t()?{open:function(t,i){function l(e){try{var t=JSON.parse(e.data);"ready"===t.a?p.postMessage(m,h):"error"===t.a?i&&(i(t.d),i=null):"response"===t.a&&(r(window,"message",l),r(window,"unload",c),c(),i&&(i(null,t.d),i=null))}catch(e){}}function c(){u&&document.body.removeChild(u),u=void 0,f&&f.close(),f=void 0}if(!i)throw"missing required callback argument";var d;t.url||(d="missing required 'url' parameter"),t.relay_url||(d="missing required 'relay_url' parameter"),d&&setTimeout(function(){i(d)},0),(!t.window_features||n())&&(t.window_features=void 0);var u,h=e(t.url);if(h!==e(t.relay_url))return setTimeout(function(){i("invalid arguments: origin of url and relay_url must match")},0);var p;s&&(u=document.createElement("iframe"),u.setAttribute("src",t.relay_url),u.style.display="none",u.setAttribute("name",a),document.body.appendChild(u),p=u.contentWindow);var f=window.open(t.url,null,t.window_features);p||(p=f);var m=JSON.stringify({a:"request",d:t.params});return o(window,"unload",c),o(window,"message",l),{close:c,focus:function(){if(f)try{f.focus()}catch(e){}}}}}:{open:function(e,t,n,i){setTimeout(function(){i("unsupported browser")},0)}}}();var o=function(){function e(){return c}function t(){return c=o()||r()||i()||n(),!c}function n(){return window.JSON&&window.JSON.stringify&&window.JSON.parse?void 0:"JSON_NOT_SUPPORTED"}function i(){return d.postMessage?void 0:"POSTMESSAGE_NOT_SUPPORTED"}function r(){try{var e="localStorage"in d&&null!==d.localStorage;if(!e)return"LOCALSTORAGE_NOT_SUPPORTED";d.localStorage.setItem("test","true"),d.localStorage.removeItem("test")}catch(t){return"LOCALSTORAGE_DISABLED"}}function o(){return a()}function a(){var e=s(),t=e>-1&&8>e;return t?"BAD_IE_VERSION":void 0}function s(){var e=-1;if("Microsoft Internet Explorer"==u.appName){var t=u.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=n.exec(t)&&(e=parseFloat(RegExp.$1))}return e}function l(e,t){u=e,d=t}var c,d=window,u=navigator;return{setTestEnv:l,isSupported:t,getNoSupportReason:e}}();if(navigator.id||(navigator.id={}),!navigator.id.request||navigator.id._shimmed){var a,s,l="https://login.persona.org",c=navigator.userAgent,d=-1!=c.indexOf("Fennec/")||-1!=c.indexOf("Firefox/")&&-1!=c.indexOf("Android"),u=d?void 0:"menubar=0,location=1,resizable=1,scrollbars=1,status=0,dialog=1,width=700,height=375",h={login:null,logout:null,ready:null},p=void 0,f=o.isSupported();navigator.id={request:function(t){if(this!=navigator.id)throw new Error("all navigator.id calls must be made on the navigator.id object");return t=t||{},e(!1),i(t)},watch:function(t){if(this!=navigator.id)throw new Error("all navigator.id calls must be made on the navigator.id object");e(!1),n(t)},logout:function(e){if(this!=navigator.id)throw new Error("all navigator.id calls must be made on the navigator.id object");t(),s&&s.notify({method:"logout"}),"function"==typeof e&&setTimeout(e,0)},get:function(t,r){r=r||{},e(!0),n({onlogin:function(e){t&&(t(e),t=null)},onlogout:function(){}}),r.oncancel=function(){t&&(t(null),t=null),h.login=h.logout=h.ready=null},r&&r.silent?t&&setTimeout(function(){t(null)},0):i(r)},getVerifiedEmail:function(t){e(!0),navigator.id.get(t)},_shimmed:!0}}}();