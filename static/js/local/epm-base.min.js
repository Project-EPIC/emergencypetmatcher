function refresh_layout(){var e={autoResize:!0,container:$("#tiles"),offset:10},t=$("#tiles li.item");t.wookmark(e)}function update_pagination(){var e=$(".pagination").pagination("getPagesCount");e=e>10?10:e,$(".pagination_container").css("width",110+35*e),$(".pagination").pagination("redraw")}function fetch_PetReports(e){$("#tiles li.item").remove(),$("#tile_container span").remove(),$.ajax({type:"GET",url:URL_GET_PETREPORTS+"/"+e,success:function(e){var t=e.pet_reports_list;e.count,e.total_count;for(var a=0;a<t.length;a++){var n=t[a],o=setup_petreport_item(n);$("#tiles").append(o)}$("#nav li.active").toggleClass("active"),$("#nav_petreports").toggleClass("active"),0==t.length?$("#tile_container").prepend("<span style='margin:10px; display:block; font-size:24px; color:gray; text-align:center;'> No Pets Available Yet! </span>"):$("#tile_container").prepend("<span style='margin:10px; display:block; font-size:24px; color:gray; text-align:center;'> Select a Pet to Begin Matching.</span>"),refresh_layout()},error:function(){alert("An unexpected error occurred when trying to get Pet Reports. Please try again.")}})}function setup_petreport_item(e){var t=document.createElement("li"),a=document.createElement("a"),n=document.createElement("img");return $(t).addClass("item"),$(a).attr("name",e.pet_name),$(a).attr("link",URL_PRDP+e.ID),$(a).on("click",function(){load_dialog({link:$(this).attr("link"),title:$(this).attr("name"),width:SIZE_WIDTH_PRDP})}),$(n).attr("src",STATIC_URL+e.img_path),$(n).width(150),$(n).height(150),$(n).css("margin","5px auto"),$(n).css("display","block"),$(a).append("<strong style='display:block; text-align:center;'>"+e.pet_name+"</strong>"),$(a).append("<span style='display:block; text-align:center;'>Contact: "+e.proposed_by_username+"</span>"),$(a).append(n),$(t).append(a),t}function fetch_PetMatches(e,t){$("#tiles li.item").remove(),$("#tile_container span").remove(),url=1==t?URL_GET_SUCCESSFUL_PETMATCHES+"/"+e:URL_GET_PETMATCHES+"/"+e,$.ajax({type:"GET",url:url,success:function(e){var a=e.pet_matches_list;e.count,e.total_count;for(var n=0;n<a.length;n++){var o=a[n],i=setup_petmatch_item(o);$("#tiles").append(i)}$("#nav li.active").toggleClass("active"),1==t?$("#nav_successful_petmatches").toggleClass("active"):$("#nav_petmatches").toggleClass("active"),0==a.length?$("#tile_container").prepend("<span style='margin:10px; display:block; font-size:24px; color:gray; text-align:center;'> No Pet Matches Available Yet! </span>"):$("#tile_container").prepend("<span style='margin:10px; display:block; font-size:24px; color:gray; text-align:center;'> Select a Pet Match to Vote on it.</span>"),refresh_layout()},error:function(){alert("An unexpected error occurred when trying to get Pet Matches. Please try again.")}})}function setup_petmatch_item(e){var t=document.createElement("li"),a=document.createElement("a"),n=document.createElement("img"),o=document.createElement("img");return $(t).addClass("item"),$(a).attr("name",e.lost_pet_name+" with "+e.found_pet_name),$(a).attr("link",URL_PMDP+e.ID),$(a).on("click",function(){load_dialog({link:$(this).attr("link"),title:$(this).attr("name"),width:SIZE_WIDTH_PMDP})}),$(n).attr("src",STATIC_URL+e.lost_pet_img_path),$(o).attr("src",STATIC_URL+e.found_pet_img_path),$(n).width(150),$(n).height(150),$(n).css("margin","5px auto"),$(n).css("display","block"),$(o).width(150),$(o).height(150),$(o).css("margin","5px auto"),$(o).css("display","block"),$(n).css("border","white solid 1px"),$(o).css("border","white solid 1px"),$(a).append("<strong style='display:block; text-align:center;'>"+e.lost_pet_name+" with "+e.found_pet_name+"</strong>"),$(a).append("<span style='display:block; text-align:center;'>Contact: "+e.proposed_by_username+"</span>"),$(a).append(n),$(a).append(o),$(t).append(a),t}function fetch_activities(e){$.ajax({type:"GET",url:URL_GET_ACTIVITIES,success:function(t){for(var a=t.activities,n=0;n<a.length;n++){var o=a[n],i=setup_activity_item(o);null!=i&&e.append(i)}return(0==a.length||0==e.children().length)&&e.append("<h3 style='font-color:gray; text-align:center;'> No Activities Yet.</h3>"),!0},error:function(){return alert("An unexpected error occurred when trying to retrieve the activities. Please try again."),!1}})}function setup_activity_item(e){var t=e.activity;if(void 0==e||void 0==t)return null;var a=e.current_userprofile_id,n=document.createElement("li"),o=document.createElement("a"),i=document.createElement("a");switch($(n).css("margin-left","2px"),$(n).css("padding-left","0px"),$(o).attr("href",URL_USERPROFILE+e.userprofile_id),$(o).html(e.userprofile_username),t){case"ACTIVITY_ACCOUNT_CREATED":$(n).append(o),$(n).append(" has just joined EPM!");break;case"ACTIVITY_PETREPORT_SUBMITTED":$(n).append(o),$(i).attr("href","#"),$(i).attr("link",URL_PRDP+e.petreport_id),$(i).on("click",function(){load_dialog({link:$(this).attr("link"),title:e.petreport_name,width:SIZE_WIDTH_PRDP})}),void 0!=e.petreport_name?($(i).html(e.petreport_name),$(n).append(" submitted a Pet Report named "),$(n).append(i),$(n).append(".")):($(i).html("Pet Report"),$(n).append(" submitted a "),$(n).append(i),$(n).append(" with no name."));break;case"ACTIVITY_PETREPORT_ADD_BOOKMARK":$(n).append(o),$(i).attr("href","#"),$(i).attr("link",URL_PRDP+e.petreport_id),$(i).on("click",function(){load_dialog({link:$(this).attr("link"),title:e.petreport_name,width:SIZE_WIDTH_PRDP})}),void 0!=e.petreport_name?($(i).html(e.petreport_name),$(n).append(" bookmarked a Pet Report named "),$(n).append(i),$(n).append(".")):($(i).html("Pet Report"),$(n).append(" bookmarked a "),$(n).append(i),$(n).append(" with no name."));break;case"ACTIVITY_PETMATCH_PROPOSED":$(i).attr("href","#"),$(i).attr("link",URL_PMDP+e.petmatch_id),$(i).html("Pet Match"),$(i).on("click",function(){load_dialog({link:$(this).attr("link"),title:e.lostpet_name+":"+e.foundpet_name,width:SIZE_WIDTH_PMDP})}),$(n).append(o),$(n).append(" proposed a "),$(n).append(i),$(n).append(" matching two "+e.petmatch_type+"s.");break;case"ACTIVITY_PETMATCH_PROPOSED_FOR_BOOKMARKED_PETREPORT":$(i).attr("href","#"),$(i).attr("link",URL_PMDP+e.petmatch_id),$(i).html("Pet Match"),$(i).on("click",function(){load_dialog({link:$(this).attr("link"),title:e.lostpet_name+":"+e.foundpet_name,width:SIZE_WIDTH_PMDP})});var r=document.createElement("a");$(r).attr("href","#"),$(r).attr("link",URL_PRDP+e.petreport_id),$(r).html("Pet Report"),$(r).on("click",function(){load_dialog({link:$(this).attr("link"),title:e.petreport_name,width:SIZE_WIDTH_PRDP})}),$(n).append(o),$(n).append(" proposed a "),$(n).append(i),$(n).append(" for the "),$(n).append(r),$(n).append(" that you bookmarked.");break;case"ACTIVITY_PETMATCH_VOTE":$(i).attr("href","#"),$(i).attr("link",URL_PMDP+e.petmatch_id),$(i).html("Pet Match"),$(i).on("click",function(){load_dialog({link:$(this).attr("link"),title:e.lostpet_name+":"+e.foundpet_name,width:SIZE_WIDTH_PMDP})}),$(n).append(o),$(n).append(" voted on a "),$(n).append(i),$(n).append(" matching two "+e.petmatch_type+"s.");break;case"ACTIVITY_FOLLOWING":if(e.userprofile2_id==e.userprofile_id)return null;if(a==e.userprofile2_id)return null;$(i).attr("href",URL_USERPROFILE+e.userprofile2_id),$(i).html(e.userprofile2_username),$(n).append(o),$(n).append(" is now following "),$(n).append(i),$(n).append(".");break;case"ACTIVITY_FOLLOWER":if(e.userprofile2_id==e.userprofile_id)return null;if(a==e.userprofile2_id)return null;$(i).attr("href",URL_USERPROFILE+e.userprofile2_id),$(i).html(e.userprofile2_username),a==e.userprofile_id?($(n).append(i),$(n).append(" is now following you!")):($(n).append(o),$(n).append(" is now being followed by "),$(n).append(i),$(n).append("."))}return n}function fetch_bookmarks(e){$("#tiles li.item").remove(),$("#tile_container span").remove(),$.ajax({type:"GET",url:URL_GET_BOOKMARKS+"/"+e,success:function(e){var t=e.bookmarks_list;e.count,e.total_count;for(var a=0;a<t.length;a++){var n=t[a],o=setup_petreport_item(n);$(o).attr("petreport_id",n.ID),$(o).hover(function(){var e=document.createElement("img");$(e).attr("src",STATIC_URL+"images/icons/button_bookmark_X.png"),$(e).addClass("bookmark_x"),$(e).width(30),$(e).height(30),$(e).css("top","-15px"),$(e).css("left","160px"),$(e).hover(function(){$(this).attr("src",STATIC_URL+"images/icons/button_bookmark_X_hover.png")},function(){$(e).attr("src",STATIC_URL+"images/icons/button_bookmark_X.png")}),$(e).click(function(){var t=$(e).parent();remove_bookmark($(t).attr("petreport_id"),t)}),$(this).append(e)},function(){var e=$(this).find(".bookmark_x");e.remove()}),$("#tiles").append(o)}$("#nav li.active").toggleClass("active"),$("#nav_bookmarked").toggleClass("active"),0==t.length?$("#tile_container").prepend("<span style='margin:10px; display:block; font-size:24px; color:gray; text-align:center;'> No Pets Available Yet! </span>"):$("#tile_container").prepend("<span style='margin:10px; display:block; font-size:24px; color:gray; text-align:center;'> Select a Pet to Begin Matching.</span>"),refresh_layout()},error:function(){alert("An unexpected error occurred when trying to get bookmarks. Please try again.")}})}function remove_bookmark(e,t){$("<div></div>").appendTo("body").html("<div><h4>Are you sure you want to remove this bookmark?</h4></div>").dialog({modal:!0,title:"Confirm Bookmark Removal",zIndex:1e4,autoOpen:!0,width:"auto",resizable:!1,buttons:{Yes:function(){$(this).dialog("close");var a=USER_ID,n=$("input").attr("value");return $.ajax({type:"POST",url:URL_BOOKMARK_PETREPORT,data:{csrfmiddlewaretoken:n,petreport_id:e,user_id:a,action:"Remove Bookmark"},success:function(e){return $("#messages").html("<li class='success'>"+e.message+"</li>"),t.remove(),refresh_layout(),!0},error:function(){return alert("An unexpected error occurred when trying to bookmark this Pet. Please try again."),!1}}),!0},No:function(){$(this).dialog("close")}},close:function(){$(this).remove()}})}$(document).ready(function(){$("#nav_petreports").click(function(){$(".pagination").pagination({items:PETREPORT_COUNT,itemsOnPage:50,cssStyle:"light-theme",onPageClick:function(e){fetch_PetReports(e)}}),update_pagination(),fetch_PetReports(1)}),$("#nav_petmatches").click(function(){$(".pagination").pagination({items:PETMATCH_COUNT,itemsOnPage:25,cssStyle:"light-theme",onPageClick:function(e){fetch_PetMatches(e,!1)}}),update_pagination(),fetch_PetMatches(1,!1)}),$("#nav_bookmarked").click(function(){$(".pagination").pagination({items:BOOKMARK_COUNT,itemsOnPage:50,cssStyle:"light-theme",onPageClick:function(e){fetch_bookmarks(e)}}),update_pagination(),fetch_bookmarks(1)}),$("#nav_successful_petmatches").click(function(){$(".pagination").pagination({items:BOOKMARK_COUNT,itemsOnPage:50,cssStyle:"light-theme",onPageClick:function(e){fetch_PetMatches(e,!0)}}),update_pagination(),fetch_PetMatches(1,!0)}),$("#facebook_share_epm").click(function(){share_on_facebook(HOME_URL,HOME_IMAGE,HOME_TITLE,HOME_CAPTION,HOME_SUMMARY)}),$("#twitter_share_epm").click(function(){share_on_twitter(HOME_URL,HOME_IMAGE,HOME_TITLE,HOME_SUMMARY)}),$("#nav_petreports").trigger("click"),fetch_activities($("#feedlist")),refresh_layout()});