{% load url from future %} <!-- Need this for forward (future) compatibility with django 1.5 and beyond. -->

<!DOCTYPE html>
<html class = 'no-js' lang = "en">
  <!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
  <!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en"> <![endif]-->
  <!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
  <!--[if gt IE 8]> <html class="no-js" lang="en"> <![endif]-->
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>{% block head_title %}Pet Report Detailed Page{% endblock head_title %}</title>
    <meta name="keywords" content="" />
    <meta name="description" content="" />

    <!-- CSS -->
    <!-- EPM Style CSS -->
    <link rel="stylesheet" href="{{ STATIC_URL }}css/style.css" type="text/css"></link>
    <!-- Include the JQuery UI Style CSS -->
    <link rel="stylesheet" href="{{ STATIC_URL }}css/ui-lightness/jquery-ui-1.8.23.custom.css" type="text/css"></link>
    <!-- Include the Reset CSS -->
    <link rel="stylesheet" href="{{ STATIC_URL }}css/reset.css" type="text/css"></link>
    
    <!-- Javascript & JQuery -->
    <!-- jquery original source -->
    <script src="{{ STATIC_URL }}js/jquery-1.8.1.min.js" type="text/javascript"></script>
    <!-- jquery UI original source -->
    <script src="{{ STATIC_URL }}js/jquery-ui-1.8.23.custom.min.js" type="text/javascript"></script>
    <!-- Include the Browser ID JS plugin -->
    <script src="{{ STATIC_URL }}js/browserid-include.js" type="text/javascript"></script>
    <!-- Include the BlockUI plugin -->
    <script src="{{ STATIC_URL }}js/jquery-blockui.js" type="text/javascript"></script>
    <!-- Include the hoverIntent plug-in -->
    <script src="{{ STATIC_URL }}js/jquery-hoverIntent.js" type="text/javascript"></script>
    <!-- Include the waypoints plug-in -->
    <script src="{{ STATIC_URL }}js/jquery-waypoints.js" type="text/javascript"></script>
    <!-- Include the imagesLoaded plug-in -->
    <script src="{{ STATIC_URL }}js/jquery-imagesloaded.js" type="text/javascript"></script>
    <!-- Include the wookmark plug-in -->
    <script src="{{ STATIC_URL }}js/jquery-wookmark.js" type="text/javascript"></script>
    
    <!-- Page-specific JS goes in this block -->
    {% block js %}
    <script type = "text/javascript">

      function bookmark(){

        var bookmark_button = $("#prdp_bookmark");
          
        var user_id = "{{ user.id }}";
        if (user_id == "None"){
          login_link = "Log in <a href={% url 'login_User' %}?next={% firstof request.path '/' %} > here.</a>";
          $(".prdp_messages").html("<li class='error'> You cannot bookmark this Pet Report because you are not logged in! "+login_link+ "</li>");
          return false;
        }

        csrf_value = $("input").attr("value");

        $.ajax({

          type:"POST",
          url:"{% url 'bookmark_PetReport' %}",
          data: {"csrfmiddlewaretoken":csrf_value, "petreport_id":"{{ pet_report.id }}", "user_id":"{{ user.id }}"},
            success: function(data){
              bookmark_button.text(data.text);
              bookmark_button.attr("title",data.text);
              $(".prdp_messages").html("<li class='success'>" + data.message + "</li>");
              return true;
            },
            error: function(data){
              alert("An unexpected error occurred when trying to bookmark this Pet Report. Please try again."); 
              return false;
            }
        });
        return true;
      }

      //This function allows us to prepare a popup upon clicking several elements.
      $(document).ready(function(){

        var bookmarked = "{{ user_has_bookmarked }}";
        var bookmark_button = $("#prdp_bookmark");

        //user is authenticated and has bookmarked this pet 
        if (bookmarked == "true"){
          bookmark_button.text("Remove Bookmark");
          bookmark_button.attr("title","Remove Bookmark");
        }

        //user has not bookmarked this pet (or) user is not authenticated
        else {
          bookmark_button.text("Bookmark this Pet");
          bookmark_button.attr("title","Bookmark this Pet");
        }


        $("#prdp_petmatch_box a").click(function(){

          var link = $(this).attr("value");
          dialog_box = $("<div></div>").load(link).dialog ({

            position: "top",
            autoOpen: true,
            closeOnEscape: true,
            title: "Pet Match Detailed Page",
            width: 850,
            height: "auto",
            modal: true,
            resizable: false,
            show: {effect:"fade", duration:500},
            buttons:{"close": function(){ $(this).dialog('close');} },
            close: function(event, ui){ 
              dialog_box.dialog('destroy').remove();
            }

          });
          return false;
        });

      });
    </script>
    {% endblock js %} 
  </head>
  <body>
    {%  block petreportcontent %}
      <div id="prdp_back">        

        <!-- PRDP Title -->
        <div class="prdp_title">
          <!--  <div style="float:left"> 
            {% if pet_report.pet_name %} {{ pet_report.pet_name }} {% endif %} 
          </div> -->
          <div style="float:left;"> {{ pet_report.status }}</div>
        </div>

        {% if messages %}
        <ul id="messages">
            {% for message in messages %}
            <li {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}        

        <!-- PRDP Image -->
		   <div class="prdp_picwrapper" > <img src="{{ STATIC_URL }}{{ pet_report.img_path }}"/><br/></div>
        <!-- Information pertaining to the PRDP -->
        <div class="prdp_info">
            <b>Pet Name:</b> {{ pet_report.pet_name }}<br/>
            <b>Pet Type:</b> {{ pet_report.pet_type }}<br/>
            <b>Lost/Found: </b> {{ pet_report.status }}<br/> 
            <b>Contact:</b>  {{  pet_report.proposed_by.user.username }}<br/>
            <b>Date {{ pet_report.status }}: </b>{{ pet_report.date_lost_or_found }}<br/>
            <b>Location:</b> {{ pet_report.location }}<br/>
            <b>Age:</b> {{ pet_report.age }}<br/> 
            <b>Sex:</b>  {{ pet_report.get_sex_display }}<br/>
            <b>Breed:</b> {{ pet_report.breed }} <br/> 
            <b>Color:</b> {{ pet_report.color }} <br/>
            <b>Size:</b> {{ pet_report.get_size_display }}<br/>
            <div class="pr_desc"><b>Description:</b> {{ pet_report.description }}<br></div>
        </div> 

        <!-- Proposed Pet Matches -->
        <div class="prdp_ppm_wk">
          <div class="prdp_subtitle"> Proposed Matches </div>

          {% for petmatch in matches  %}
            <div id = "prdp_petmatch_box"> 
              <a href = "#" class = "prdp_petmatch_link" value = "{% url 'display_PetMatch' petmatch.id %}">

                {% ifequal pet_report.status 'Lost' %}
                  <img class = "prdp_petmatch_img" src="{{ STATIC_URL}}{{ petmatch.found_pet.img_path }}" />
                {% else %}
                  <img class = "prdp_petmatch_img" src="{{ STATIC_URL}}{{ petmatch.lost_pet.img_path }}" />
                {% endifequal %}  

              </a>
              <div id="prdp_user_box" style="float:right;">
                <a href= "{% url 'get_UserProfile_page' petmatch.proposed_by.id %}"><!-- {{ petmatch.proposed_by.user.username }}  -->
                  {% if petmatch.proposed_by.photo %}    
                    <img src="{{ STATIC_URL }}{{ petmatch.proposed_by.photo }}" class = "prdp_worker_img" />   
                  {% else %}
                    <img src="{{ STATIC_URL }}/images/defaults/anonymous.gif" class = "prdp_worker_img" />
                  {% endif %}
                </a>
              </div>
            </div> 
          {% endfor %}

        </div>

        <!-- People Working on this Pet -->
        <div class="prdp_ppm_wk">
          <div class="prdp_subtitle"> People working on this pet </div>
            {% for worker in pet_report.workers.all  %}
              <div id = "prdp_user_box">
                <a href= "{% url 'get_UserProfile_page' worker.id %}" title = "{{ worker.user.username }}" >

                  {% if worker.photo %}    
                    <img src="{{ STATIC_URL }}{{ worker.photo }}" alt = "{{ worker.user.username }}" class = "prdp_worker_img" />   
                  {% else %}
                    <img src="{{ STATIC_URL }}/images/defaults/anonymous.gif" alt = "{{ worker.user.username }}"  class = "prdp_worker_img" />
                  {% endif %}
                </a>
              </div> 
            {% endfor %}
        </div> 

        <!-- Buttons -->
        <div id ="prdp_buttons">
          <a class = "prdp_eachbutton" id="prdp_bookmark"  title="bookmark this pet" style="float:left;cursor:pointer;" onclick="bookmark();" innerText="blah">
            {% csrf_token %}
            <!-- Bookmark this Pet -->
          </a>
          <a class = "prdp_eachbutton" href="{% url 'match_PetReport' pet_report.id %}" style="float:right;" >Work on this Pet</a>
        </div>
              <!-- Messages -->
        <ul id="messages" class="prdp_messages" style = "margin-top:40px;">
          {% for message in messages %}
            <li {% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
          {% endfor %}
        </ul>              
      </div>
    {%  endblock petreportcontent %}
  </body>
</html>
